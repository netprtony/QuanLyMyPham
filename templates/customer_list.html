{% extends "layout.html" %}
{% block title %}
    Danh Sách Khách Hàng
{% endblock %}
{% block content %}
<div class="management">
    <div class="header">
        <h2>Danh Mục Khách Hàng</h2>
    </div>
    <div class="actions">
        <button class="btn-add" onclick="toggleModal()">Thêm Khách Hàng</button>
    </div>
    </div>
    <div class="list">
        <table class="table">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Mã</th>
                    <th>Tên</th>
                    <th>Địa chỉ</th>
                    <th>Số điện thoại</th>
                    <th>Email</th>
                    <th>Mức độ</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                {% for index, customer in enumerate(customers) %}
                    <tr>
                        <td>{{ index + 1 }}</td> 
                        <td>{{ customer['customer_id'] }}</td>
                        <td>{{ customer['name'] }}</td>
                        <td>{{ customer.address.street }}, {{ customer['address']['city'] }}, {{ customer.address.postal_code }}</td>
                        <td>{{ customer['phone'] }}</td>
                        <td>{{ customer['email'] }}</td>
                        <td>{{ customer['role'] }}</td>
                        <td>
                            <button type="button" class="btn btn-warning" data-bs-toggle="offcanvas" data-bs-target="#editCustomerCanvas{{ customer['customer_id'] }}">
                                Sửa
                            </button>
                            <form action="" method="POST" style="display:inline;">
                                <button type="submit" class="btn-delete" onclick="return confirm('Bạn có chắc chắn muốn xóa khách hàng này không?');">Xóa</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <!-- Modal (Off-canvas) Thêm Khách Hàng -->
        <div id="addCustomerModal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="toggleModal()">&times;</span>
                <h2>Thêm Khách Hàng Mới</h2>
                <form action="{{ url_for('customer_bp.add_customer') }}" method="POST">
                    <div class="form-group">
                        <label for="customer_id" class="form-label">Mã Khách Hàng</label>
                        <input type="text" class="form-control" id="customer_id" name="customer_id" required>
                    </div>
                    <div class="form-group">
                        <label for="name">Tên Khách Hàng:</label>
                        <input type="text" name="name" id="name" required>
                    </div>
                    <div class="form-group">
                        <label for="gender" class="form-label">Giới Tính</label>
                        <select class="form-select" id="gender" name="gender" required>
                            <option value="" disabled selected>Chọn giới tính</option>
                            <option value="male">Nam</option>
                            <option value="female">Nữ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="age">Tuổi:</label>
                        <input type="number" name="age" id="age" required>
                    </div>
                    <div class="form-group">
                        <label for="street">Số đường/nhà:</label>
                        <input id="street" name="street" required class="form-control"></input>
                    </div>
                    <div class="form-group">
                        <label for="city">Thành phố:</label>
                        <input id="city" name="city" required class="form-control"></input>
                    </div>
                    <div class="form-group">
                        <label for="postal_code">Mã Bưu Điện:</label>
                        <input id="postal_code" name="postal_code" required class="form-control"></input>
                    </div>
                    <div class="form-group">
                        <label for="phone">Số Điện Thoại:</label>
                        <input type="text" name="phone" id="phone" required>
                    </div>

                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" name="email" id="email" required>
                    </div>
                    <div class="form-group">
                        <label for="role">Role:</label>
                        <select class="form-select" name="role" id="role" required>
                            <option value="Normal" {% if customer and customer['role'] == 'Normal' %}selected{% endif %}>Normal</option>
                            <option value="VIP" {% if customer and customer['role'] == 'VIP' %}selected{% endif %}>VIP</option>
                            <option value="Admin" {% if customer and customer['role'] == 'Admin' %}selected{% endif %}>Admin</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-add">Thêm</button>
                </form>
            </div>
        </div>
        <div class="offcanvas offcanvas-end" tabindex="-1" id="editCustomerCanvas{{ customer['customer_id'] }}" aria-labelledby="editCustomerLabel">
            <div class="offcanvas-header">
              <h5 id="editCustomerLabel">Chỉnh Sửa Khách Hàng</h5>
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
              <form action="{{ url_for('customer_bp.edit_customer', customer_id=customer['customer_id']) }}" method="POST">
                <div class="mb-3">
                  <label for="name" class="form-label">Tên khách hàng</label>
                  <input type="text" class="form-control" id="name" name="name" value="{{ customer['name'] }}">
                </div>
                <div class="mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="email" name="email" value="{{ customer['email'] }}">
                </div>
                <div class="mb-3">
                  <label for="phone" class="form-label">Số điện thoại</label>
                  <input type="text" class="form-control" id="phone" name="phone" value="{{ customer['phone'] }}">
                </div>
                <div class="mb-3">
                  <label for="gender" class="form-label">Giới tính</label>
                  <select class="form-select" id="gender" name="gender">
                    <option value="male" {% if customer['gender'] == 'male' %}selected{% endif %}>Nam</option>
                    <option value="female" {% if customer['gender'] == 'female' %}selected{% endif %}>Nữ</option>
                  </select>
                </div>
                <!-- Các trường khác tương tự -->
                <button type="submit" class="btn btn-primary">Lưu Thay Đổi</button>
              </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}